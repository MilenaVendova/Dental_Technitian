<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Case Details - Dental Practice</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #BCDDE4;
      min-height: 100vh;
      padding: 20px;
    }

    .app-container {
      background: #EDEDED;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      max-width: 1000px;
      margin: 0 auto;
      animation: slideUp 0.6s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      background: linear-gradient(135deg, #197CAE 0%, #003049 100%);
      padding: 30px;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-info h1 {
      font-size: 28px;
      margin-bottom: 5px;
    }

    .header-info p {
      opacity: 0.9;
      font-size: 14px;
    }

    .case-status {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      margin-left: 15px;
      display: inline-block;
    }

    .status-new { background: #e3f2fd; color: #1976d2; }
    .status-in-progress { background: #fff3e0; color: #f57c00; }
    .status-completed { background: #e8f5e8; color: #388e3c; }
    .status-urgent { background: #ffebee; color: #d32f2f; }

    .header-actions {
      display: flex;
      gap: 15px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .btn-primary {
      background: #FFCB05;
      color: #003049;
    }

    .btn-primary:hover {
      background: #e6b405;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .content {
      padding: 40px 30px;
    }

    .case-overview {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
      margin-bottom: 40px;
    }

    .main-info {
      background: white;
      border-radius: 15px;
      padding: 30px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .main-info:hover {
      border-color: #197CAE;
      box-shadow: 0 10px 25px rgba(0, 48, 73, 0.1);
    }

    .case-title {
      font-size: 24px;
      color: #003049;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #BCDDE4;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .info-item {
      display: flex;
      flex-direction: column;
    }

    .info-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
      text-transform: uppercase;
      font-weight: 500;
    }

    .info-value {
      font-size: 16px;
      color: #003049;
      font-weight: 600;
    }

    .priority-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 500;
    }

    .priority-normal { background: #e3f2fd; color: #1976d2; }
    .priority-urgent { background: #ffebee; color: #d32f2f; }

    .side-panel {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .panel-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .panel-card:hover {
      border-color: #197CAE;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 48, 73, 0.1);
    }

    .panel-card h3 {
      color: #003049;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .notes-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .notes-section:hover {
      border-color: #197CAE;
      box-shadow: 0 10px 25px rgba(0, 48, 73, 0.1);
    }

    .notes-content {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid #197CAE;
      font-style: italic;
      color: #003049;
      line-height: 1.6;
    }

    .technical-specs {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .technical-specs:hover {
      border-color: #197CAE;
      box-shadow: 0 10px 25px rgba(0, 48, 73, 0.1);
    }

    .specs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
    }

    .spec-item {
      text-align: center;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    .spec-item:hover {
      background: #BCDDE4;
      transform: translateY(-2px);
    }

    .spec-icon {
      font-size: 30px;
      margin-bottom: 10px;
      display: block;
    }

    .spec-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }

    .spec-value {
      font-size: 16px;
      color: #003049;
      font-weight: 600;
    }

    .action-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 30px;
    }

    .action-btn {
      background: linear-gradient(135deg, #197CAE 0%, #003049 100%);
      color: white;
      border: none;
      padding: 15px 20px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      position: relative;
    }

    .action-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(25, 124, 174, 0.3);
    }

    .payment-status {
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
    }

    .payment-pending { background: #fff3e0; color: #f57c00; }
    .payment-paid { background: #e8f5e8; color: #388e3c; }
    .payment-overdue { background: #ffebee; color: #d32f2f; }
    .payment-partial { background: #e3f2fd; color: #1976d2; }
    .payment-insurance { background: #f3e5f5; color: #7b1fa2; }
    .payment-cancelled { background: #eeeeee; color: #616161; }

    .delivery-info {
      background: #f0f8ff;
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid #197CAE;
      margin-top: 20px;
    }

    .delivery-info h4 {
      color: #003049;
      margin-bottom: 10px;
    }

    .delivery-address {
      color: #003049;
      line-height: 1.5;
    }

    /* Activity Log Styles */
    .activity-log-container {
      background: #f0f8ff;
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid #197CAE;
      margin-top: 20px;
    }

    .activity-log {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 15px;
    }

    .activity-entry {
      display: flex;
      gap: 12px;
      padding: 12px;
      background: white;
      border-radius: 8px;
      margin-bottom: 8px;
      border-left: 3px solid #197CAE;
      transition: all 0.3s ease;
    }

    .activity-entry:hover {
      transform: translateX(3px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .activity-entry:last-child {
      margin-bottom: 0;
    }

    .activity-icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }

    .activity-icon.status-change {
      background: #e3f2fd;
      color: #1976d2;
    }

    .activity-icon.note-added {
      background: #f3e5f5;
      color: #7b1fa2;
    }

    .activity-icon.file-upload {
      background: #e8f5e8;
      color: #388e3c;
    }

    .activity-icon.assignment {
      background: #fff3e0;
      color: #f57c00;
    }

    .activity-icon.message-sent {
      background: #e0f7fa;
      color: #00796b;
    }

    .activity-icon.case-created {
      background: #fce4ec;
      color: #c2185b;
    }

    .activity-content {
      flex: 1;
    }

    .activity-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .activity-user {
      font-weight: 600;
      color: #003049;
      font-size: 13px;
    }

    .activity-time {
      color: #666;
      font-size: 11px;
    }

    .activity-action {
      font-weight: 500;
      color: #197CAE;
      margin-bottom: 2px;
      font-size: 13px;
    }

    .activity-details {
      color: #666;
      font-size: 12px;
      line-height: 1.3;
    }

    .activity-log-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      border-top: 1px solid #ddd;
      padding-top: 15px;
      flex-wrap: wrap;
    }

    .activity-action-btn {
      background: linear-gradient(135deg, #197CAE 0%, #003049 100%);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .activity-action-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(25, 124, 174, 0.3);
    }

    .activity-log::-webkit-scrollbar {
      width: 6px;
    }

    .activity-log::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }

    .activity-log::-webkit-scrollbar-thumb {
      background: #197CAE;
      border-radius: 3px;
    }

    .activity-log::-webkit-scrollbar-thumb:hover {
      background: #003049;
    }

    /* Edit Case Modal Styles - Updated to match patient modal */
    .edit-case-modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.3s ease;
    }

    .edit-case-modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .edit-case-container {
      background-color: #EDEDED;
      margin: 20px auto;
      padding: 0;
      width: 90%;
      max-width: 900px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
      max-height: 90vh;
      overflow-y: auto;
    }

    .edit-case-header {
      background: linear-gradient(135deg, #197CAE 0%, #003049 100%);
      padding: 25px 30px;
      color: white;
      border-radius: 20px 20px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .edit-case-header h2 {
      font-size: 24px;
      margin: 0;
    }

    .edit-case-header p {
      font-size: 14px;
      opacity: 0.9;
      margin-top: 5px;
    }

    .close-edit-case {
      color: white;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      background: none;
      border: none;
      opacity: 0.8;
      transition: opacity 0.3s;
    }

    .close-edit-case:hover {
      opacity: 1;
    }

    .edit-case-content {
      padding: 30px;
    }

    .modal-form-section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .modal-form-section:hover {
      border-color: #197CAE;
      box-shadow: 0 5px 15px rgba(0, 48, 73, 0.1);
    }

    .modal-form-section h3 {
      color: #003049;
      font-size: 18px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 12px;
      border-bottom: 2px solid #EDEDED;
    }

    .modal-form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .modal-form-group {
      display: flex;
      flex-direction: column;
    }

    .modal-form-group.full-width {
      grid-column: 1 / -1;
    }

    .modal-form-group label {
      margin-bottom: 6px;
      font-weight: 600;
      color: #003049;
      font-size: 13px;
    }

    .required {
      color: #d32f2f;
    }

    .modal-form-group input,
    .modal-form-group select,
    .modal-form-group textarea {
      padding: 10px 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .modal-form-group input:focus,
    .modal-form-group select:focus,
    .modal-form-group textarea:focus {
      outline: none;
      border-color: #197CAE;
      box-shadow: 0 0 0 3px rgba(25, 124, 174, 0.1);
    }

    .modal-form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .char-counter {
      color: #197CAE;
      font-size: 11px;
      text-align: right;
      margin-top: 4px;
    }

    .modal-alert {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid;
    }

    .modal-alert-info {
      background: #d1ecf1;
      color: #0c5460;
      border-color: #17a2b8;
    }

    .modal-alert-success {
      background: #d4edda;
      color: #155724;
      border-color: #28a745;
      display: none;
    }

    .priority-selector {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 8px;
    }

    .status-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 8px;
    }

    .priority-option, .status-option {
      padding: 10px 15px;
      border: 2px solid #ddd;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 13px;
      font-weight: 500;
    }

    .priority-option:hover, .status-option:hover {
      border-color: #197CAE;
    }

    .priority-option.selected, .status-option.selected {
      border-color: #197CAE;
      background: #197CAE;
      color: white;
    }

    .notes-list {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 15px;
    }

    .note-item {
      background: white;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 3px solid #197CAE;
    }

    .note-item:last-child {
      margin-bottom: 0;
    }

    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }

    .note-author {
      font-weight: 500;
      font-size: 12px;
      color: #003049;
    }

    .note-time {
      font-size: 11px;
      color: #666;
    }

    .note-content {
      font-size: 13px;
      color: #003049;
      line-height: 1.4;
    }

    .add-note-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-top: 15px;
    }

    /* Tooth Chart Styles */
    .tooth-chart-container {
      background: white;
      border: 2px solid #197CAE;
      border-radius: 15px;
      padding: 15px;
      margin-top: 15px;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
    }

    .tooth-chart {
      min-width: 600px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .tooth-row {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
      gap: 10px;
    }

    .tooth-row.upper {
      margin-bottom: 30px;
    }

    .teeth-group {
      display: flex;
      gap: 5px;
    }

    .midline {
      font-size: 24px;
      color: #197CAE;
      font-weight: bold;
      margin: 0 15px;
    }

    .tooth-number {
      width: 35px;
      height: 35px;
      border: 2px solid #ddd;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
      transition: all 0.3s ease;
      background: white;
    }

    .tooth-number:hover {
      border-color: #197CAE;
      transform: scale(1.1);
      box-shadow: 0 2px 8px rgba(25, 124, 174, 0.3);
    }

    .tooth-number.selected {
      background: #197CAE;
      color: white;
      border-color: #197CAE;
      transform: scale(1.05);
    }

    .selected-teeth {
      margin-top: 15px;
      padding: 10px 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #197CAE;
    }

    .modal-footer {
      display: flex;
      justify-content: center;
      gap: 15px;
      padding: 20px 0 0;
      border-top: 2px solid #EDEDED;
      margin-top: 20px;
    }

    .modal-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .modal-btn-primary {
      background: linear-gradient(135deg, #197CAE 0%, #003049 100%);
      color: white;
    }

    .modal-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(25, 124, 174, 0.4);
    }

    .modal-btn-secondary {
      background: #EDEDED;
      color: #003049;
      border: 2px solid #197CAE;
    }

    .modal-btn-secondary:hover {
      background: #BCDDE4;
      transform: translateY(-1px);
    }

    @media (max-width: 768px) {
      .case-overview {
        grid-template-columns: 1fr;
      }

      .info-grid {
        grid-template-columns: 1fr;
      }

      .specs-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }

      .action-buttons {
        grid-template-columns: 1fr;
      }

      .activity-log {
        max-height: 250px;
      }

      .activity-entry {
        padding: 10px;
        flex-direction: column;
        gap: 8px;
      }

      .activity-icon {
        width: 25px;
        height: 25px;
        font-size: 12px;
        align-self: flex-start;
      }

      .activity-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 2px;
      }

      .activity-log-actions {
        flex-direction: column;
        gap: 8px;
      }

      .activity-action-btn {
        width: 100%;
        justify-content: center;
        padding: 10px 16px;
        font-size: 13px;
      }

      .edit-case-container {
        width: 95%;
        margin: 10px auto;
      }

      .edit-case-content {
        padding: 20px;
      }

      .modal-form-grid {
        grid-template-columns: 1fr;
      }

      .priority-selector, .status-selector {
        grid-template-columns: repeat(2, 1fr);
      }

      .modal-footer {
        flex-direction: column;
        align-items: stretch;
      }

      .modal-btn {
        width: 100%;
      }

      .tooth-chart-container {
        padding: 10px;
        border-radius: 10px;
      }

      .tooth-chart {
        min-width: 500px;
      }

      .tooth-number {
        width: 28px;
        height: 28px;
        font-size: 10px;
      }

      .midline {
        font-size: 18px;
        margin: 0 8px;
      }

      .teeth-group {
        gap: 3px;
      }
    }

    @media (max-width: 480px) {
      .tooth-chart {
        min-width: 400px;
      }

      .tooth-number {
        width: 24px;
        height: 24px;
        font-size: 9px;
      }

      .teeth-group {
        gap: 2px;
      }

      .midline {
        font-size: 16px;
        margin: 0 5px;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <div class="header-info">
        <h1>Case #0001</h1>
        <p>Crown Restoration - Maria Rodriguez</p>
        <span class="case-status status-in-progress">IN PROGRESS</span>
      </div>
      <div class="header-actions">
        <button class="btn btn-primary" onclick="openEditCase()">Edit Case</button>
        <a href="#" class="btn btn-secondary" onclick="goBack()">‚Üê Back to Cases</a>
      </div>
    </div>

    <div class="content">
      <!-- Case Overview -->
      <div class="case-overview">
        <div class="main-info">
          <div class="case-title">Case Information</div>
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Patient Name</div>
              <div class="info-value">Maria Rodriguez</div>
            </div>
            <div class="info-item">
              <div class="info-label">Doctor</div>
              <div class="info-value">Dr. Sarah Johnson</div>
            </div>
            <div class="info-item">
              <div class="info-label">Practice</div>
              <div class="info-value">Downtown Dental Clinic</div>
            </div>
            <div class="info-item">
              <div class="info-label">Technician</div>
              <div class="info-value">John Tech</div>
            </div>
            <div class="info-item">
              <div class="info-label">Case Date</div>
              <div class="info-value">August 1, 2025</div>
            </div>
            <div class="info-item">
              <div class="info-label">Deadline</div>
              <div class="info-value">August 3, 2025</div>
            </div>
            <div class="info-item">
              <div class="info-label">Priority</div>
              <div class="info-value">
                <span class="priority-badge priority-urgent">URGENT</span>
              </div>
            </div>
            <div class="info-item">
              <div class="info-label">Price</div>
              <div class="info-value" style="font-size: 20px; color: #197CAE; font-weight: bold;">$450.00</div>
            </div>
            <div class="info-item">
              <div class="info-label">Payment Status</div>
              <div class="info-value">
                <span class="payment-status payment-pending">PENDING</span>
              </div>
            </div>
            <div class="info-item">
              <div class="info-label">Tooth Number</div>
              <div class="info-value">#14</div>
            </div>
          </div>
        </div>

        <div class="side-panel">
          <div class="panel-card">
            <h3>üìã Case Summary</h3>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span>Case Type</span>
                <span style="font-weight: bold; color: #197CAE;">Crown Restoration</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span>Priority</span>
                <span class="priority-badge priority-urgent">URGENT</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span>Status</span>
                <span style="font-weight: bold; color: #f57c00;">In Progress</span>
              </div>
              <div style="display: flex; justify-content: space-between; border-top: 1px solid #ddd; padding-top: 10px; margin-top: 10px;">
                <span style="font-weight: bold;">Total Price</span>
                <span style="font-weight: bold; color: #197CAE; font-size: 18px;">$450.00</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Technical Specifications -->
      <div class="technical-specs">
        <div class="case-title">Technical Specifications</div>
        <div class="specs-grid">
          <div class="spec-item">
            <span class="spec-icon">ü¶∑</span>
            <div class="spec-label">Item Type</div>
            <div class="spec-value">Crown</div>
          </div>
          <div class="spec-item">
            <span class="spec-icon">üíé</span>
            <div class="spec-label">Material</div>
            <div class="spec-value">Zirconia</div>
          </div>
          <div class="spec-item">
            <span class="spec-icon">üé®</span>
            <div class="spec-label">Shade</div>
            <div class="spec-value">A2</div>
          </div>
        </div>
      </div>

      <!-- Activity Log Section -->
      <div class="notes-section">
        <div class="case-title">üìä Recent Activity</div>
        <div class="activity-log-container">
          <div class="activity-log" id="activityLog">
            <div class="activity-entry">
              <div class="activity-icon case-created">üÜï</div>
              <div class="activity-content">
                <div class="activity-header">
                  <span class="activity-user">Dr. Sarah Johnson</span>
                  <span class="activity-time">2 min ago</span>
                </div>
                <div class="activity-action">Case created</div>
                <div class="activity-details">New crown restoration case submitted for Maria Rodriguez, tooth #14</div>
              </div>
            </div>

            <div class="activity-entry">
              <div class="activity-icon assignment">üë®‚Äçüî¨</div>
              <div class="activity-content">
                <div class="activity-header">
                  <span class="activity-user">Lab Manager</span>
                  <span class="activity-time">5 min ago</span>
                </div>
                <div class="activity-action">Assigned to technician</div>
                <div class="activity-details">Case assigned to John Tech for processing</div>
              </div>
            </div>

            <div class="activity-entry">
              <div class="activity-icon status-change">üìù</div>
              <div class="activity-content">
                <div class="activity-header">
                  <span class="activity-user">John Tech</span>
                  <span class="activity-time">10 min ago</span>
                </div>
                <div class="activity-action">Status updated</div>
                <div class="activity-details">Changed status from "New" to "In Progress"</div>
              </div>
            </div>
          </div>

          <div class="activity-log-actions">
            <button class="activity-action-btn" onclick="loadMoreActivities()">
              <span>‚¨áÔ∏è</span> Load More
            </button>
            <button class="activity-action-btn" onclick="exportActivityLog()">
              <span>üìä</span> Export Log
            </button>
          </div>
        </div>
      </div>

      <!-- Notes Section -->
      <div class="notes-section">
        <div class="case-title">Special Instructions & Notes</div>
        <div class="notes-content">
          "Rush order - patient has important event this weekend. Please ensure perfect color match with adjacent teeth. Patient prefers slightly more translucent finish. Contact Dr. Johnson if any questions about occlusion."
        </div>
      </div>

      <!-- Delivery Information -->
      <div class="notes-section">
        <div class="case-title">Delivery Information</div>
        <div class="delivery-info">
          <h4>üìç Delivery Address</h4>
          <div class="delivery-address">
            Downtown Dental Clinic<br>
            123 Main Street, Suite 200<br>
            Downtown, State 12345<br>
            Phone: (555) 123-4567
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="action-btn" onclick="openEditCase()">
          <span>‚úèÔ∏è</span> Edit Case
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Case Modal -->
  <div id="editCaseModal" class="edit-case-modal">
    <div class="edit-case-container">
      <div class="edit-case-header">
        <div>
          <h2>‚úèÔ∏è Edit Case</h2>
          <p>Case #0001 - Crown Restoration</p>
        </div>
        <button class="close-edit-case" onclick="closeEditCase()">&times;</button>
      </div>

      <div class="edit-case-content">
        <div id="modalSuccessAlert" class="modal-alert modal-alert-success">
          ‚úÖ Case updated successfully!
        </div>

        <div id="modalInfoAlert" class="modal-alert modal-alert-info">
          üí° Update the case information below. Fields marked with * are required.
        </div>

        <form id="editCaseForm">
          <!-- Patient Information Section -->
          <div class="modal-form-section">
            <h3>üë§ Patient Information</h3>
            <div class="modal-form-grid">
              <div class="modal-form-group">
                <label for="editPatientName">Patient Name <span class="required">*</span></label>
                <input type="text" id="editPatientName" value="Maria Rodriguez" required>
              </div>
              <div class="modal-form-group">
                <label for="editToothNumber">Tooth Number</label>
                <input type="text" id="editToothNumber" value="#14">
              </div>
              <div class="modal-form-group">
                <label for="editDoctor">Doctor <span class="required">*</span></label>
                <input type="text" id="editDoctor" value="Dr. Sarah Johnson" required>
              </div>
              <div class="modal-form-group">
                <label for="editPractice">Practice</label>
                <input type="text" id="editPractice" value="Downtown Dental Clinic">
              </div>
            </div>
          </div>

          <!-- Case Details Section -->
          <div class="modal-form-section">
            <h3>üìã Case Details</h3>
            <div class="modal-form-grid">
              <div class="modal-form-group">
                <label for="editCaseType">Case Type <span class="required">*</span></label>
                <select id="editCaseType" required>
                  <option value="Crown Restoration" selected>Crown Restoration</option>
                  <option value="Bridge">Bridge</option>
                  <option value="Veneer">Veneer</option>
                  <option value="Implant Crown">Implant Crown</option>
                  <option value="Partial Denture">Partial Denture</option>
                  <option value="Full Denture">Full Denture</option>
                </select>
              </div>
              <div class="modal-form-group">
                <label for="editMaterial">Material</label>
                <select id="editMaterial">
                  <option value="Zirconia" selected>Zirconia</option>
                  <option value="Porcelain">Porcelain</option>
                  <option value="Metal Ceramic">Metal Ceramic</option>
                  <option value="Lithium Disilicate">Lithium Disilicate</option>
                  <option value="Composite">Composite</option>
                </select>
              </div>
              <div class="modal-form-group">
                <label for="editShade">Shade</label>
                <input type="text" id="editShade" value="A2">
              </div>
              <div class="modal-form-group">
                <label for="editPrice">Price</label>
                <input type="number" id="editPrice" value="450" min="0" step="0.01">
              </div>
              <div class="modal-form-group">
                <label for="editDeadline">Deadline</label>
                <input type="date" id="editDeadline" value="2025-08-03">
              </div>
              <div class="modal-form-group">
                <label for="editTechnician">Technician</label>
                <select id="editTechnician">
                  <option value="John Tech" selected>John Tech</option>
                  <option value="Sarah Tech">Sarah Tech</option>
                  <option value="Mike Lab">Mike Lab</option>
                  <option value="Lisa Craft">Lisa Craft</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Tooth Selection Section -->
          <div class="modal-form-section">
            <h3>ü¶∑ Tooth Selection</h3>
            <div class="modal-form-group full-width">
              <label>Select Affected Teeth <span class="required">*</span></label>
              <div class="modal-alert modal-alert-info" style="margin: 10px 0;">
                üí° Click on the teeth that need treatment. Scroll horizontally on mobile to see all teeth.
              </div>
              <div class="tooth-chart-container">
                <div class="tooth-chart">
                  <div class="tooth-row upper">
                    <div class="teeth-group">
                      <div class="tooth-number" onclick="toggleTooth(18, this)">18</div>
                      <div class="tooth-number" onclick="toggleTooth(17, this)">17</div>
                      <div class="tooth-number" onclick="toggleTooth(16, this)">16</div>
                      <div class="tooth-number" onclick="toggleTooth(15, this)">15</div>
                      <div class="tooth-number selected" onclick="toggleTooth(14, this)">14</div>
                      <div class="tooth-number" onclick="toggleTooth(13, this)">13</div>
                      <div class="tooth-number" onclick="toggleTooth(12, this)">12</div>
                      <div class="tooth-number" onclick="toggleTooth(11, this)">11</div>
                    </div>
                    <div class="midline">|</div>
                    <div class="teeth-group">
                      <div class="tooth-number" onclick="toggleTooth(21, this)">21</div>
                      <div class="tooth-number" onclick="toggleTooth(22, this)">22</div>
                      <div class="tooth-number" onclick="toggleTooth(23, this)">23</div>
                      <div class="tooth-number" onclick="toggleTooth(24, this)">24</div>
                      <div class="tooth-number" onclick="toggleTooth(25, this)">25</div>
                      <div class="tooth-number" onclick="toggleTooth(26, this)">26</div>
                      <div class="tooth-number" onclick="toggleTooth(27, this)">27</div>
                      <div class="tooth-number" onclick="toggleTooth(28, this)">28</div>
                    </div>
                  </div>
                  
                  <div class="tooth-row lower">
                    <div class="teeth-group">
                      <div class="tooth-number" onclick="toggleTooth(48, this)">48</div>
                      <div class="tooth-number" onclick="toggleTooth(47, this)">47</div>
                      <div class="tooth-number" onclick="toggleTooth(46, this)">46</div>
                      <div class="tooth-number" onclick="toggleTooth(45, this)">45</div>
                      <div class="tooth-number" onclick="toggleTooth(44, this)">44</div>
                      <div class="tooth-number" onclick="toggleTooth(43, this)">43</div>
                      <div class="tooth-number" onclick="toggleTooth(42, this)">42</div>
                      <div class="tooth-number" onclick="toggleTooth(41, this)">41</div>
                    </div>
                    <div class="midline">|</div>
                    <div class="teeth-group">
                      <div class="tooth-number" onclick="toggleTooth(31, this)">31</div>
                      <div class="tooth-number" onclick="toggleTooth(32, this)">32</div>
                      <div class="tooth-number" onclick="toggleTooth(33, this)">33</div>
                      <div class="tooth-number" onclick="toggleTooth(34, this)">34</div>
                      <div class="tooth-number" onclick="toggleTooth(35, this)">35</div>
                      <div class="tooth-number" onclick="toggleTooth(36, this)">36</div>
                      <div class="tooth-number" onclick="toggleTooth(37, this)">37</div>
                      <div class="tooth-number" onclick="toggleTooth(38, this)">38</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="selected-teeth" id="selectedTeeth">
                <strong>Selected Teeth:</strong> <span id="selectedTeethList">14</span>
              </div>
              <input type="hidden" id="editToothNumbers" value="14" required>
            </div>
          </div>

          <!-- Priority and Status Section -->
          <div class="modal-form-section">
            <h3>‚ö° Priority & Status</h3>
            <div class="modal-form-grid">
              <div class="modal-form-group">
                <label>Priority Level</label>
                <div class="priority-selector">
                  <div class="priority-option" data-priority="normal">üîµ Normal</div>
                  <div class="priority-option selected" data-priority="urgent">üî¥ Urgent</div>
                </div>
              </div>
              <div class="modal-form-group">
                <label>Case Status</label>
                <div class="status-selector">
                  <div class="status-option" data-status="new">New</div>
                  <div class="status-option selected" data-status="in-progress">In Progress</div>
                  <div class="status-option" data-status="quality-check">Quality Check</div>
                  <div class="status-option" data-status="completed">Completed</div>
                  <div class="status-option" data-status="delivered">Delivered</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Special Instructions Section -->
          <div class="modal-form-section">
            <h3>üìù Special Instructions</h3>
            <div class="modal-form-group full-width">
              <label for="editInstructions">Instructions & Notes</label>
              <textarea id="editInstructions" placeholder="Enter special instructions, notes, or requirements..." maxlength="2048">Rush order - patient has important event this weekend. Please ensure perfect color match with adjacent teeth. Patient prefers slightly more translucent finish. Contact Dr. Johnson if any questions about occlusion.</textarea>
              <div class="char-counter" id="instructionsCounter">278/2048</div>
            </div>
          </div>

          <!-- Case Notes Section -->
          <div class="modal-form-section">
            <h3>üí¨ Case Notes</h3>
            <div class="add-note-section">
              <div class="notes-list" id="notesList">
                <div class="note-item">
                  <div class="note-header">
                    <span class="note-author">Dr. Sarah Johnson</span>
                    <span class="note-time">15 min ago</span>
                  </div>
                  <div class="note-content">Added special instructions for rush order requirements.</div>
                </div>
                <div class="note-item">
                  <div class="note-header">
                    <span class="note-author">John Tech</span>
                    <span class="note-time">10 min ago</span>
                  </div>
                  <div class="note-content">Reviewed digital impressions - quality looks excellent for fabrication.</div>
                </div>
              </div>
              <div class="modal-form-group">
                <label for="newNoteContent">Add New Note</label>
                <textarea id="newNoteContent" placeholder="Add a note about this case..." style="min-height: 60px;" maxlength="500"></textarea>
                <div class="char-counter" id="noteCounter">0/500</div>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="modal-btn modal-btn-secondary" onclick="closeEditCase()">Cancel</button>
            <button type="button" class="modal-btn modal-btn-primary" onclick="saveCase()" id="saveChangesBtn">üíæ Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Current user info
    const currentUser = {
      name: "John Tech",
      avatar: "üë®‚Äçüî¨",
      role: "Technician"
    };

    // Track selected teeth (initialize with tooth 14 as it's already selected)
    let selectedTeeth = [14];

    function addActivityEntry(action, details, type = 'status-change') {
      const activityLog = document.getElementById('activityLog');
      const now = new Date();
      const timeAgo = "Just now";
      
      let icon = 'üìù';
      
      if (action.toLowerCase().includes('note') || action.toLowerCase().includes('message')) {
        type = 'note-added';
        icon = 'üí¨';
      } else if (action.toLowerCase().includes('file') || action.toLowerCase().includes('upload')) {
        type = 'file-upload';
        icon = 'üìé';
      } else if (action.toLowerCase().includes('assign')) {
        type = 'assignment';
        icon = 'üë®‚Äçüî¨';
      } else if (action.toLowerCase().includes('message') || action.toLowerCase().includes('sent')) {
        type = 'message-sent';
        icon = '‚úâÔ∏è';
      } else if (action.toLowerCase().includes('creat')) {
        type = 'case-created';
        icon = 'üÜï';
      } else if (action.toLowerCase().includes('complet')) {
        type = 'status-change';
        icon = '‚úÖ';
      }
      
      const activityEntry = document.createElement('div');
      activityEntry.className = 'activity-entry';
      activityEntry.style.opacity = '0';
      activityEntry.style.transform = 'translateX(-10px)';
      
      activityEntry.innerHTML = `
        <div class="activity-icon ${type}">${icon}</div>
        <div class="activity-content">
          <div class="activity-header">
            <span class="activity-user">${currentUser.name}</span>
            <span class="activity-time">${timeAgo}</span>
          </div>
          <div class="activity-action">${action}</div>
          <div class="activity-details">${details}</div>
        </div>
      `;
      
      if (activityLog.firstChild) {
        activityLog.insertBefore(activityEntry, activityLog.firstChild);
      } else {
        activityLog.appendChild(activityEntry);
      }
      
      setTimeout(() => {
        activityEntry.style.transition = 'all 0.5s ease';
        activityEntry.style.opacity = '1';
        activityEntry.style.transform = 'translateX(0)';
      }, 100);
      
      setTimeout(() => {
        activityEntry.style.backgroundColor = '#e8f5e8';
        setTimeout(() => {
          activityEntry.style.backgroundColor = 'white';
        }, 2000);
      }, 600);
    }

    function loadMoreActivities() {
      const activityLog = document.getElementById('activityLog');
      
      const moreActivities = [
        {
          icon: 'üìù',
          type: 'status-change',
          user: 'John Tech',
          time: '1 day ago',
          action: 'Updated case priority',
          details: 'Changed priority from Normal to High due to patient request'
        },
        {
          icon: 'üìû',
          type: 'message-sent',
          user: 'Dr. Sarah Johnson',
          time: '1 day ago',
          action: 'Phone consultation',
          details: 'Discussed case details and confirmed specifications'
        },
        {
          icon: 'üìù',
          type: 'note-added',
          user: 'Lab Manager',
          time: '2 days ago',
          action: 'Quality review',
          details: 'Case reviewed and approved for production'
        }
      ];
      
      moreActivities.forEach((activity, index) => {
        setTimeout(() => {
          const activityEntry = document.createElement('div');
          activityEntry.className = 'activity-entry';
          activityEntry.style.opacity = '0';
          activityEntry.style.transform = 'translateY(20px)';
          
          activityEntry.innerHTML = `
            <div class="activity-icon ${activity.type}">${activity.icon}</div>
            <div class="activity-content">
              <div class="activity-header">
                <span class="activity-user">${activity.user}</span>
                <span class="activity-time">${activity.time}</span>
              </div>
              <div class="activity-action">${activity.action}</div>
              <div class="activity-details">${activity.details}</div>
            </div>
          `;
          
          activityLog.appendChild(activityEntry);
          
          setTimeout(() => {
            activityEntry.style.transition = 'all 0.5s ease';
            activityEntry.style.opacity = '1';
            activityEntry.style.transform = 'translateY(0)';
          }, 100);
          
        }, index * 200);
      });
      
      showNotification('üì• Loaded 3 more activities', '#197CAE');
    }

    function exportActivityLog() {
      const activityEntries = document.querySelectorAll('#activityLog .activity-entry');
      
      if (!activityEntries || activityEntries.length === 0) {
        showNotification('‚ùå No activities to export', '#f44336');
        return;
      }
      
      showNotification(`üìä Exporting ${activityEntries.length} activities...`, '#197CAE');
      
      setTimeout(() => {
        addActivityEntry(
          'Exported activity log',
          `Generated export file with ${activityEntries.length} activity entries`
        );
        showNotification('‚úÖ Activity log exported successfully!', '#4caf50');
      }, 1500);
    }

    function showNotification(message, color = '#197CAE') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed; 
        top: 20px; 
        right: 20px; 
        background: ${color}; 
        color: white; 
        padding: 12px 20px; 
        border-radius: 20px; 
        z-index: 1000; 
        animation: slideUp 0.5s ease;
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      `;
      notification.innerHTML = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-20px)';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Edit Case Functions
    function openEditCase() {
      const modal = document.getElementById('editCaseModal');
      modal.classList.add('show');
      document.body.style.overflow = 'hidden';
      
      initializeEditForm();
      updateCharCounters();
      updateSelectedTeethDisplay();
    }

    function closeEditCase() {
      // Check if form has been modified
      const hasChanges = checkForUnsavedChanges();
      
      if (hasChanges) {
        if (!confirm('‚ö†Ô∏è You have unsaved changes. Are you sure you want to close without saving?')) {
          return; // Don't close if user cancels
        }
      }
      
      const modal = document.getElementById('editCaseModal');
      modal.classList.remove('show');
      document.body.style.overflow = 'auto';
      
      // Reset alerts
      document.getElementById('modalSuccessAlert').style.display = 'none';
      document.getElementById('modalInfoAlert').style.display = 'block';
      
      console.log('Edit modal closed'); // Debug log
    }

    function checkForUnsavedChanges() {
      // Check if any form fields have been modified from their original values
      const currentPatientName = document.getElementById('editPatientName').value.trim();
      const currentDoctor = document.getElementById('editDoctor').value.trim();
      const currentNotes = document.getElementById('newNoteContent').value.trim();
      
      // Simple check - in a real app, you'd compare against original values
      return currentNotes.length > 0; // If there's a new note, consider it a change
    }

    function initializeEditForm() {
      // Initialize priority selector
      const priorityOptions = document.querySelectorAll('.priority-option');
      priorityOptions.forEach(option => {
        option.addEventListener('click', function() {
          priorityOptions.forEach(o => o.classList.remove('selected'));
          this.classList.add('selected');
        });
      });

      // Initialize status selector
      const statusOptions = document.querySelectorAll('.status-option');
      statusOptions.forEach(option => {
        option.addEventListener('click', function() {
          statusOptions.forEach(o => o.classList.remove('selected'));
          this.classList.add('selected');
        });
      });
    }

    function updateCharCounters() {
      // Instructions counter
      const instructionsInput = document.getElementById('editInstructions');
      const instructionsCounter = document.getElementById('instructionsCounter');
      
      function updateInstructionsCounter() {
        const currentLength = instructionsInput.value.length;
        instructionsCounter.textContent = `${currentLength}/2048`;
        
        if (currentLength > 1800) {
          instructionsCounter.style.color = '#dc3545';
        } else if (currentLength > 1400) {
          instructionsCounter.style.color = '#856404';
        } else {
          instructionsCounter.style.color = '#197CAE';
        }
      }
      
      instructionsInput.addEventListener('input', updateInstructionsCounter);
      updateInstructionsCounter(); // Initial count
      
      // Note counter
      const noteInput = document.getElementById('newNoteContent');
      const noteCounter = document.getElementById('noteCounter');
      
      function updateNoteCounter() {
        const currentLength = noteInput.value.length;
        noteCounter.textContent = `${currentLength}/500`;
        
        if (currentLength > 450) {
          noteCounter.style.color = '#dc3545';
        } else if (currentLength > 350) {
          noteCounter.style.color = '#856404';
        } else {
          noteCounter.style.color = '#197CAE';
        }
      }
      
      noteInput.addEventListener('input', updateNoteCounter);
      updateNoteCounter(); // Initial count
    }

    function saveCase() {
      // Immediate feedback
      alert('Save button clicked! This confirms the button is working.');
      
      console.log('Save case function called'); // Debug log
      
      // Get all form values
      const formData = {
        patientName: document.getElementById('editPatientName').value.trim(),
        toothNumber: document.getElementById('editToothNumber').value.trim(),
        doctor: document.getElementById('editDoctor').value.trim(),
        practice: document.getElementById('editPractice').value.trim(),
        caseType: document.getElementById('editCaseType').value,
        material: document.getElementById('editMaterial').value,
        shade: document.getElementById('editShade').value.trim(),
        price: document.getElementById('editPrice').value,
        deadline: document.getElementById('editDeadline').value,
        technician: document.getElementById('editTechnician').value,
        priority: document.querySelector('.priority-option.selected')?.dataset.priority || 'normal',
        status: document.querySelector('.status-option.selected')?.dataset.status || 'in-progress',
        instructions: document.getElementById('editInstructions').value.trim(),
        newNote: document.getElementById('newNoteContent').value.trim()
      };

      console.log('Form data collected:', formData); // Debug log

      // Validate required fields
      const requiredFields = [];
      if (!formData.patientName) requiredFields.push('Patient Name');
      if (!formData.doctor) requiredFields.push('Doctor');
      if (!formData.caseType) requiredFields.push('Case Type');
      
      if (requiredFields.length > 0) {
        showNotification(`‚ùå Please fill in all required fields: ${requiredFields.join(', ')}`, '#f44336');
        return;
      }

      // Validate tooth selection
      if (selectedTeeth.length === 0) {
        showNotification('‚ùå Please select at least one tooth', '#f44336');
        return;
      }

      // Show saving progress with enhanced visual feedback
      const saveBtn = document.getElementById('saveChangesBtn');
      const originalText = saveBtn.innerHTML;
      
      saveBtn.innerHTML = '‚è≥ Saving...';
      saveBtn.disabled = true;
      saveBtn.style.opacity = '0.7';
      saveBtn.style.cursor = 'not-allowed';

      console.log('Starting save process...'); // Debug log

      // Simulate save process
      setTimeout(() => {
        try {
          console.log('Updating case display...'); // Debug log
          
          // Update the case display
          updateCaseDisplay(formData);
          
          // Add note if provided
          if (formData.newNote) {
            console.log('Adding new note:', formData.newNote); // Debug log
            addNewNote(formData.newNote);
          }
          
          // Add to activity log
          let activityDetails = 'Modified case details, priority, status, and other information';
          if (selectedTeeth.length > 0) {
            activityDetails += `. Updated affected teeth: ${selectedTeeth.sort((a, b) => a - b).join(', ')}`;
          }
          
          addActivityEntry(
            'Updated case information',
            activityDetails
          );
          
          // Show success message
          document.getElementById('modalInfoAlert').style.display = 'none';
          const successAlert = document.getElementById('modalSuccessAlert');
          successAlert.style.display = 'block';
          successAlert.innerHTML = '‚úÖ Case updated successfully! Changes have been saved.';
          
          // Reset button
          saveBtn.innerHTML = originalText;
          saveBtn.disabled = false;
          saveBtn.style.opacity = '1';
          saveBtn.style.cursor = 'pointer';
          
          // Clear new note field
          document.getElementById('newNoteContent').value = '';
          updateCharCounters();
          
          console.log('Save completed successfully'); // Debug log
          
          // Show success notification
          showNotification('‚úÖ Case updated successfully!', '#4caf50');
          
          // Close modal after delay
          setTimeout(() => {
            closeEditCase();
            
            // Reset success alert for next time
            setTimeout(() => {
              successAlert.style.display = 'none';
              successAlert.innerHTML = '‚úÖ Case updated successfully!';
              document.getElementById('modalInfoAlert').style.display = 'block';
            }, 500);
          }, 2000);
          
        } catch (error) {
          console.error('Error during save:', error);
          
          // Reset button on error
          saveBtn.innerHTML = originalText;
          saveBtn.disabled = false;
          saveBtn.style.opacity = '1';
          saveBtn.style.cursor = 'pointer';
          
          showNotification('‚ùå Error saving case. Please try again.', '#f44336');
        }
        
      }, 1500);
    }

    function updateCaseDisplay(formData) {
      // Update info grid values
      const infoFields = {
        'Patient Name': formData.patientName,
        'Doctor': formData.doctor,
        'Practice': formData.practice,
        'Technician': formData.technician,
        'Price': `${parseFloat(formData.price).toFixed(2)}`,
        'Tooth Number': selectedTeeth.length > 0 ? selectedTeeth.sort((a, b) => a - b).map(t => `#${t}`).join(', ') : formData.toothNumber,
        'Deadline': new Date(formData.deadline).toLocaleDateString('en-US', { 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        })
      };

      Object.entries(infoFields).forEach(([label, value]) => {
        const labelElement = Array.from(document.querySelectorAll('.info-label'))
          .find(el => el.textContent === label);
        if (labelElement) {
          const valueElement = labelElement.parentNode.querySelector('.info-value');
          if (valueElement) {
            if (label === 'Price') {
              valueElement.innerHTML = `<span style="font-size: 20px; color: #197CAE; font-weight: bold;">${value}</span>`;
            } else {
              valueElement.textContent = value;
            }
          }
        }
      });

      // Update priority badge
      const priorityBadge = document.querySelector('.priority-badge');
      if (priorityBadge) {
        priorityBadge.className = `priority-badge priority-${formData.priority}`;
        priorityBadge.textContent = formData.priority.toUpperCase();
      }

      // Update status
      const statusElements = document.querySelectorAll('.case-status');
      statusElements.forEach(el => {
        el.textContent = formData.status.toUpperCase().replace('-', ' ');
        el.className = `case-status status-${formData.status}`;
      });

      // Update technical specs
      updateTechnicalSpecs(formData);
      
      // Update special instructions
      const instructionsContent = document.querySelector('.notes-content');
      if (instructionsContent) {
        instructionsContent.textContent = `"${formData.instructions}"`;
      }

      // Update case summary
      updateCaseSummary(formData);
    }

    function updateTechnicalSpecs(formData) {
      const specs = [
        { label: 'Item Type', value: formData.caseType.includes('Crown') ? 'Crown' : formData.caseType },
        { label: 'Material', value: formData.material },
        { label: 'Shade', value: formData.shade }
      ];

      specs.forEach(spec => {
        const labelElement = Array.from(document.querySelectorAll('.spec-label'))
          .find(el => el.textContent === spec.label);
        if (labelElement) {
          const valueElement = labelElement.parentNode.querySelector('.spec-value');
          if (valueElement) {
            valueElement.textContent = spec.value;
          }
        }
      });
    }

    function updateCaseSummary(formData) {
      const summaryContainer = document.querySelector('.panel-card div[style*="background: #f8f9fa"]');
      if (summaryContainer) {
        const priorityClass = `priority-${formData.priority}`;
        const statusText = formData.status.replace('-', ' ').split(' ').map(word => 
          word.charAt(0).toUpperCase() + word.slice(1)
        ).join(' ');
        
        summaryContainer.innerHTML = `
          <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <span>Case Type</span>
            <span style="font-weight: bold; color: #197CAE;">${formData.caseType}</span>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <span>Priority</span>
            <span class="priority-badge ${priorityClass}">${formData.priority.toUpperCase()}</span>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <span>Status</span>
            <span style="font-weight: bold; color: #f57c00;">${statusText}</span>
          </div>
          <div style="display: flex; justify-content: space-between; border-top: 1px solid #ddd; padding-top: 10px; margin-top: 10px;">
            <span style="font-weight: bold;">Total Price</span>
            <span style="font-weight: bold; color: #197CAE; font-size: 18px;">$${parseFloat(formData.price).toFixed(2)}</span>
          </div>
        `;
      }
    }

    function addNewNote(noteContent) {
      const notesList = document.getElementById('notesList');
      const newNote = document.createElement('div');
      newNote.className = 'note-item';
      newNote.style.opacity = '0';
      newNote.style.transform = 'translateY(-10px)';
      
      newNote.innerHTML = `
        <div class="note-header">
          <span class="note-author">${currentUser.name}</span>
          <span class="note-time">Just now</span>
        </div>
        <div class="note-content">${noteContent}</div>
      `;
      
      if (notesList.firstChild) {
        notesList.insertBefore(newNote, notesList.firstChild);
      } else {
        notesList.appendChild(newNote);
      }
      
      setTimeout(() => {
        newNote.style.transition = 'all 0.5s ease';
        newNote.style.opacity = '1';
        newNote.style.transform = 'translateY(0)';
      }, 100);
      
      addActivityEntry(
        'Added case note',
        `Note: "${noteContent.length > 50 ? noteContent.substring(0, 50) + '...' : noteContent}"`
      );
    }

    function goBack() {
      showNotification('‚Üê Returning to cases list...', '#197CAE');
    }

    // Tooth Selection Functions
    function toggleTooth(toothNumber, element) {
      const index = selectedTeeth.indexOf(toothNumber);
      
      if (index > -1) {
        selectedTeeth.splice(index, 1);
        element.classList.remove('selected');
      } else {
        selectedTeeth.push(toothNumber);
        element.classList.add('selected');
      }
      
      updateSelectedTeethDisplay();
    }

    function updateSelectedTeethDisplay() {
      const display = document.getElementById('selectedTeeth');
      const list = document.getElementById('selectedTeethList');
      const input = document.getElementById('editToothNumbers');
      
      if (selectedTeeth.length > 0) {
        display.style.display = 'block';
        list.textContent = selectedTeeth.sort((a, b) => a - b).join(', ');
        input.value = selectedTeeth.join(',');
      } else {
        display.style.display = 'block'; // Keep visible but show message
        list.textContent = 'No teeth selected';
        input.value = '';
      }
    }

    // Form submission and event listeners
    function setupFormEventListeners() {
      console.log('Setting up form event listeners...'); // Debug log
      
      // Keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        const modal = document.getElementById('editCaseModal');
        if (modal && modal.classList.contains('show')) {
          // Ctrl+S or Cmd+S to save
          if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            console.log('Save triggered by keyboard shortcut'); // Debug log
            saveCase();
          }
          // Escape to close
          if (e.key === 'Escape') {
            e.preventDefault();
            closeEditCase();
          }
        }
      });
      
      console.log('Event listeners set up successfully'); // Debug log
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('editCaseModal');
      if (event.target == modal) {
        closeEditCase();
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, initializing case details page...'); // Debug log
      
      const cards = document.querySelectorAll('.main-info, .panel-card, .technical-specs, .notes-section');
      cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        card.style.animation = 'slideUp 0.6s ease-out forwards';
      });
      
      // Setup form event listeners
      setupFormEventListeners();
      
      console.log('Case details page initialized successfully'); // Debug log
    });
  </script>
</body>
</html>