<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>New Case - Dental Practice</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #BCDDE4;
      min-height: 100vh;
      padding: 20px;
    }

    .app-container {
      background: #EDEDED;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      max-width: 1000px;
      margin: 0 auto;
      animation: slideUp 0.6s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      background: linear-gradient(135deg, #197CAE 0%, #003049 100%);
      padding: 30px;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-info h1 {
      font-size: 28px;
      margin-bottom: 5px;
    }

    .header-info p {
      opacity: 0.9;
      font-size: 14px;
    }

    .progress-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-left: 20px;
    }

    .progress-step {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
    }

    .progress-step.active {
      background: #FFCB05;
      color: #003049;
    }

    .progress-line {
      width: 40px;
      height: 2px;
      background: rgba(255, 255, 255, 0.3);
    }

    .progress-line.active {
      background: #FFCB05;
    }

    .header-actions {
      display: flex;
      gap: 15px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .btn-primary {
      background: #FFCB05;
      color: #003049;
    }

    .btn-primary:hover {
      background: #e6b405;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .content {
      padding: 40px 30px;
    }

    .form-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .form-section:hover {
      border-color: #197CAE;
      box-shadow: 0 10px 25px rgba(0, 48, 73, 0.1);
    }

    .section-title {
      font-size: 20px;
      color: #003049;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #BCDDE4;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      margin-bottom: 8px;
      font-weight: 600;
      color: #003049;
      font-size: 14px;
    }

    .required {
      color: #d32f2f;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 12px 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .form-group select:disabled {
      background-color: #f5f5f5;
      color: #999;
      cursor: not-allowed;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #197CAE;
      box-shadow: 0 0 0 3px rgba(25, 124, 174, 0.1);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-group input[type="date"] {
      color: #003049;
    }

    .form-group input[type="number"] {
      text-align: right;
    }

    .input-group {
      position: relative;
    }

    .input-prefix {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #666;
      font-weight: 500;
    }

    .input-group input {
      padding-left: 35px;
    }

    .priority-selector {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .priority-option {
      padding: 12px 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      font-weight: 500;
    }

    .priority-option.selected {
      border-color: #197CAE;
      background: #197CAE;
      color: white;
    }

    .priority-normal { border-color: #2196f3; }
    .priority-normal.selected { background: #2196f3; }
    .priority-urgent { border-color: #f44336; }
    .priority-urgent.selected { background: #f44336; }

    .tooth-chart {
      background: white;
      border: 2px solid #197CAE;
      border-radius: 15px;
      padding: 20px;
      margin-top: 15px;
    }

    .tooth-row {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
      gap: 10px;
    }

    .tooth-row.upper {
      margin-bottom: 30px;
    }

    .teeth-group {
      display: flex;
      gap: 5px;
    }

    .quadrant-label {
      font-size: 12px;
      color: #666;
      font-weight: 500;
      writing-mode: vertical-rl;
      text-orientation: mixed;
      min-width: 60px;
      text-align: center;
    }

    .midline {
      font-size: 24px;
      color: #197CAE;
      font-weight: bold;
      margin: 0 15px;
    }

    .tooth-number {
      width: 35px;
      height: 35px;
      border: 2px solid #ddd;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
      transition: all 0.3s ease;
      background: white;
    }

    .tooth-number:hover {
      border-color: #197CAE;
      transform: scale(1.1);
      box-shadow: 0 2px 8px rgba(25, 124, 174, 0.3);
    }

    .tooth-number.selected {
      background: #197CAE;
      color: white;
      border-color: #197CAE;
      transform: scale(1.05);
    }

    .selected-teeth {
      margin-top: 15px;
      padding: 10px 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #197CAE;
    }

    .form-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      border-top: 2px solid #BCDDE4;
      margin-top: 20px;
    }

    .validation-error {
      color: #d32f2f;
      font-size: 12px;
      margin-top: 5px;
    }

    .success-message {
      background: #e8f5e8;
      color: #388e3c;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      border-left: 4px solid #388e3c;
    }

    .info-box {
      background: #e3f2fd;
      color: #1976d2;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      border-left: 4px solid #1976d2;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }

      .form-navigation {
        flex-direction: column;
        gap: 15px;
      }

      .tooth-chart {
        padding: 15px;
      }

      .quadrant-label {
        font-size: 10px;
        min-width: 40px;
      }

      .tooth-number {
        width: 30px;
        height: 30px;
        font-size: 11px;
      }

      .teeth-group {
        gap: 3px;
      }

      .midline {
        font-size: 20px;
        margin: 0 10px;
      }

      .file-categories {
        grid-template-columns: 1fr;
      }

      .file-types {
        gap: 8px;
      }

      .file-type {
        font-size: 11px;
        padding: 4px 8px;
      }
    }

    .file-upload-area {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 20px;
      border: 2px dashed #197CAE;
    }

    .file-upload-main {
      background: white;
      border: 2px dashed #197CAE;
      border-radius: 15px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 25px;
    }

    .file-upload-main:hover {
      background: #BCDDE4;
      border-color: #003049;
      transform: translateY(-2px);
    }

    .file-upload-icon {
      font-size: 60px;
      margin-bottom: 15px;
      color: #197CAE;
    }

    .file-upload-main h3 {
      color: #003049;
      margin-bottom: 10px;
      font-size: 20px;
    }

    .file-upload-main p {
      color: #666;
      margin-bottom: 20px;
    }

    .file-types {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .file-type {
      background: #e3f2fd;
      color: #1976d2;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .file-categories {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .file-category {
      background: white;
      border-radius: 10px;
      padding: 20px;
      border: 1px solid #ddd;
    }

    .file-category h4 {
      color: #003049;
      margin-bottom: 8px;
      font-size: 16px;
    }

    .file-category p {
      color: #666;
      font-size: 14px;
      margin-bottom: 15px;
    }

    .category-files {
      min-height: 40px;
      border: 1px dashed #ddd;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      color: #999;
      font-size: 12px;
    }

    .category-files:empty::before {
      content: "No files uploaded";
    }

    .uploaded-files-list {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
    }

    .uploaded-file {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 4px solid #197CAE;
    }

    .uploaded-file:last-child {
      margin-bottom: 0;
    }

    .file-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .file-icon {
      font-size: 20px;
    }

    .file-details {
      display: flex;
      flex-direction: column;
    }

    .file-name {
      font-weight: 500;
      color: #003049;
    }

    .file-size {
      font-size: 12px;
      color: #666;
    }

    .file-remove {
      background: #f44336;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .file-remove:hover {
      background: #d32f2f;
      transform: translateY(-1px);
    }

    .auto-save {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #e8f5e8;
      color: #388e3c;
      padding: 10px 15px;
      border-radius: 20px;
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .auto-save.show {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="auto-save" id="autoSave">‚úÖ Draft saved automatically</div>

  <div class="app-container">
    <div class="header">
      <div class="header-info">
        <h1>Create New Case</h1>
        <p>Complete the form to create a new dental laboratory case</p>
        <div class="progress-indicator">
          <div class="progress-step active">1</div>
          <div class="progress-line"></div>
          <div class="progress-step">2</div>
          <div class="progress-line"></div>
          <div class="progress-step">3</div>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" onclick="saveDraft()">Save Draft</button>
        <a href="#" class="btn btn-secondary" onclick="goBack()">‚Üê Cancel</a>
      </div>
    </div>

    <div class="content">
      <form id="newCaseForm">
        <!-- Patient & Doctor Information -->
        <div class="form-section">
          <div class="section-title">
            <span>üë§</span> Patient & Doctor Information
          </div>
          <div class="info-box">
            üí° <strong>Tip:</strong> Enter the doctor's name first to see their patients and practices. Both dropdowns will update automatically based on where the doctor works.
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="doctorName">Doctor Name <span class="required">*</span></label>
              <input type="text" id="doctorName" placeholder="Enter doctor's full name" required oninput="updatePatientList()">
            </div>
            <div class="form-group">
              <label for="patientSelect">Patient <span class="required">*</span></label>
              <select id="patientSelect" required disabled>
                <option value="">First enter doctor name to see patients</option>
              </select>
            </div>
            <div class="form-group">
              <label for="practiceSelect">Practice <span class="required">*</span></label>
              <select id="practiceSelect" required disabled>
                <option value="">First enter doctor name to see practices</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Case Details -->
        <div class="form-section">
          <div class="section-title">
            <span>ü¶∑</span> Case Details & Specifications
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="itemType">Item Type <span class="required">*</span></label>
              <select id="itemType" required onchange="updateMaterialOptions()">
                <option value="">Select Item Type</option>
                <option value="1">Crown</option>
                <option value="2">Bridge</option>
                <option value="3">Denture (Full)</option>
                <option value="4">Denture (Partial)</option>
                <option value="5">Orthodontic Appliance</option>
                <option value="6">Implant Crown</option>
                <option value="7">Inlay/Onlay</option>
                <option value="8">Veneer</option>
              </select>
            </div>
            <div class="form-group">
              <label for="material">Material</label>
              <select id="material">
                <option value="">Select Material</option>
                <option value="1">Porcelain</option>
                <option value="2">Zirconia</option>
                <option value="3">Metal (Gold)</option>
                <option value="4">Metal (Titanium)</option>
                <option value="5">Composite</option>
                <option value="6">Ceramic</option>
                <option value="7">Lithium Disilicate</option>
              </select>
            </div>
            <div class="form-group">
              <label for="shade">Shade Selection</label>
              <select id="shade">
                <option value="">Select Shade</option>
                <option value="1">A1 (Light Reddish Brown)</option>
                <option value="2">A2 (Reddish Brown)</option>
                <option value="3">A3 (Dark Reddish Brown)</option>
                <option value="4">A3.5 (Dark Reddish Brown)</option>
                <option value="5">A4 (Dark Reddish Brown)</option>
                <option value="6">B1 (Light Reddish Yellow)</option>
                <option value="7">B2 (Reddish Yellow)</option>
                <option value="8">B3 (Dark Reddish Yellow)</option>
                <option value="9">B4 (Dark Reddish Yellow)</option>
                <option value="10">C1 (Light Gray)</option>
                <option value="11">C2 (Gray)</option>
                <option value="12">C3 (Dark Gray)</option>
                <option value="13">C4 (Dark Gray)</option>
                <option value="14">D2 (Reddish Gray)</option>
                <option value="15">D3 (Dark Reddish Gray)</option>
                <option value="16">D4 (Dark Reddish Gray)</option>
              </select>
            </div>
            <div class="form-group">
              <label>Priority Level</label>
              <div class="priority-selector">
                <div class="priority-option priority-normal selected" onclick="selectPriority(2, this)">
                  <div>üîµ Normal</div>
                  <small>Regular</small>
                </div>
                <div class="priority-option priority-urgent" onclick="selectPriority(4, this)">
                  <div>üî¥ Urgent</div>
                  <small>Rush</small>
                </div>
              </div>
              <input type="hidden" id="priorityLevel" value="2">
            </div>
          </div>
        </div>

        <!-- File Uploads -->
        <div class="form-section">
          <div class="section-title">
            <span>üìÅ</span> Case Documentation & Files
          </div>
          <div class="info-box">
            üì∑ <strong>Upload Important Files:</strong> X-rays, photos, impressions, prescriptions, or any reference materials for this case.
          </div>
          
          <div class="file-upload-area">
            <div class="file-upload-main" onclick="document.getElementById('fileInput').click()">
              <div class="file-upload-icon">üìÅ</div>
              <h3>Drop files here or click to browse</h3>
              <p>Upload photos, X-rays, impressions, or documents</p>
              <div class="file-types">
                <span class="file-type">üì∑ Images</span>
                <span class="file-type">üìÑ PDFs</span>
                <span class="file-type">üî¨ DICOM</span>
                <span class="file-type">üìã Documents</span>
              </div>
            </div>
            <input type="file" id="fileInput" multiple accept=".jpg,.jpeg,.png,.pdf,.dcm,.dicom,.doc,.docx" style="display: none;" onchange="handleFileUpload(this)">
            
            <div class="file-categories">
              <div class="file-category">
                <h4>üì∑ Clinical Photos</h4>
                <p>Pre-treatment, impressions, bite photos</p>
                <div class="category-files" id="photoFiles"></div>
              </div>
              
              <div class="file-category">
                <h4>üî¨ Radiographs</h4>
                <p>X-rays, CBCT scans, diagnostic images</p>
                <div class="category-files" id="xrayFiles"></div>
              </div>
              
              <div class="file-category">
                <h4>üìã Documents</h4>
                <p>Prescriptions, lab orders, notes</p>
                <div class="category-files" id="documentFiles"></div>
              </div>
            </div>
            
            <div id="uploadedFiles" class="uploaded-files-list"></div>
          </div>

        <!-- Tooth Selection -->
        <div class="form-section">
          <div class="section-title">
            <span>ü¶∑</span> Tooth Selection
          </div>
          <div class="form-group">
            <label>Select Affected Teeth <span class="required">*</span></label>
            <div class="info-box">
              Click on the teeth that need treatment. The layout shows teeth as they appear in the mouth (clinician's view).
            </div>
            <div class="tooth-chart">
              <div class="tooth-row upper">
                <div class="quadrant-label">Upper Right</div>
                <div class="teeth-group">
                  <div class="tooth-number" onclick="toggleTooth(18, this)">18</div>
                  <div class="tooth-number" onclick="toggleTooth(17, this)">17</div>
                  <div class="tooth-number" onclick="toggleTooth(16, this)">16</div>
                  <div class="tooth-number" onclick="toggleTooth(15, this)">15</div>
                  <div class="tooth-number" onclick="toggleTooth(14, this)">14</div>
                  <div class="tooth-number" onclick="toggleTooth(13, this)">13</div>
                  <div class="tooth-number" onclick="toggleTooth(12, this)">12</div>
                  <div class="tooth-number" onclick="toggleTooth(11, this)">11</div>
                </div>
                <div class="midline">|</div>
                <div class="teeth-group">
                  <div class="tooth-number" onclick="toggleTooth(21, this)">21</div>
                  <div class="tooth-number" onclick="toggleTooth(22, this)">22</div>
                  <div class="tooth-number" onclick="toggleTooth(23, this)">23</div>
                  <div class="tooth-number" onclick="toggleTooth(24, this)">24</div>
                  <div class="tooth-number" onclick="toggleTooth(25, this)">25</div>
                  <div class="tooth-number" onclick="toggleTooth(26, this)">26</div>
                  <div class="tooth-number" onclick="toggleTooth(27, this)">27</div>
                  <div class="tooth-number" onclick="toggleTooth(28, this)">28</div>
                </div>
                <div class="quadrant-label">Upper Left</div>
              </div>
              
              <div class="tooth-row lower">
                <div class="quadrant-label">Lower Right</div>
                <div class="teeth-group">
                  <div class="tooth-number" onclick="toggleTooth(48, this)">48</div>
                  <div class="tooth-number" onclick="toggleTooth(47, this)">47</div>
                  <div class="tooth-number" onclick="toggleTooth(46, this)">46</div>
                  <div class="tooth-number" onclick="toggleTooth(45, this)">45</div>
                  <div class="tooth-number" onclick="toggleTooth(44, this)">44</div>
                  <div class="tooth-number" onclick="toggleTooth(43, this)">43</div>
                  <div class="tooth-number" onclick="toggleTooth(42, this)">42</div>
                  <div class="tooth-number" onclick="toggleTooth(41, this)">41</div>
                </div>
                <div class="midline">|</div>
                <div class="teeth-group">
                  <div class="tooth-number" onclick="toggleTooth(31, this)">31</div>
                  <div class="tooth-number" onclick="toggleTooth(32, this)">32</div>
                  <div class="tooth-number" onclick="toggleTooth(33, this)">33</div>
                  <div class="tooth-number" onclick="toggleTooth(34, this)">34</div>
                  <div class="tooth-number" onclick="toggleTooth(35, this)">35</div>
                  <div class="tooth-number" onclick="toggleTooth(36, this)">36</div>
                  <div class="tooth-number" onclick="toggleTooth(37, this)">37</div>
                  <div class="tooth-number" onclick="toggleTooth(38, this)">38</div>
                </div>
                <div class="quadrant-label">Lower Left</div>
              </div>
            </div>
            <div class="selected-teeth" id="selectedTeeth" style="display: none;">
              <strong>Selected Teeth:</strong> <span id="selectedTeethList"></span>
            </div>
            <input type="hidden" id="toothNumbers" required>
          </div>
        </div>

        <!-- Timeline & Pricing -->
        <div class="form-section">
          <div class="section-title">
            <span>üí∞</span> Timeline & Pricing
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="deadline">Deadline Date</label>
              <input type="date" id="deadline" min="<?php echo date('Y-m-d', strtotime('+1 day')); ?>">
            </div>
            <div class="form-group">
              <label for="price">Price <span class="required">*</span></label>
              <div class="input-group">
                <span class="input-prefix">$</span>
                <input type="number" id="price" step="0.01" placeholder="0.00" required>
              </div>
            </div>
            <div class="form-group">
              <label for="paymentStatus">Payment Status <span class="required">*</span></label>
              <select id="paymentStatus" required>
                <option value="">Select Payment Status</option>
                <option value="1">Pending Payment</option>
                <option value="2">Paid in Full</option>
                <option value="3">Partial Payment</option>
                <option value="4">Insurance Processing</option>
                <option value="5">Overdue</option>
                <option value="6">Payment Plan</option>
                <option value="7">Cancelled</option>
                <option value="8">Refunded</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Notes & Instructions -->
        <div class="form-section">
          <div class="section-title">
            <span>üìù</span> Notes & Special Instructions
          </div>
          <div class="form-group">
            <label for="notes">Special Instructions</label>
            <textarea id="notes" placeholder="Enter any special instructions, patient preferences, or clinical notes..."></textarea>
          </div>
          <div class="form-group">
            <label for="deliveryAddress">Custom Delivery Address (Optional)</label>
            <textarea id="deliveryAddress" placeholder="If different from the practice address, enter custom delivery address..."></textarea>
          </div>
        </div>

        <!-- Form Navigation -->
        <div class="form-navigation">
          <div>
            <small style="color: #666;">All fields marked with <span class="required">*</span> are required</small>
          </div>
          <div style="display: flex; gap: 15px;">
            <button type="button" class="btn btn-secondary" onclick="resetForm()">Reset Form</button>
            <button type="submit" class="btn btn-primary">Create Case</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script>
    let selectedTeeth = [];
    let selectedPriority = 2;

    function selectPriority(priority, element) {
      // Remove selected class from all options
      document.querySelectorAll('.priority-option').forEach(opt => opt.classList.remove('selected'));
      
      // Add selected class to clicked option
      element.classList.add('selected');
      
      // Update hidden input
      document.getElementById('priorityLevel').value = priority;
      selectedPriority = priority;
    }

    function toggleTooth(toothNumber, element) {
      const index = selectedTeeth.indexOf(toothNumber);
      
      if (index > -1) {
        // Remove tooth
        selectedTeeth.splice(index, 1);
        element.classList.remove('selected');
      } else {
        // Add tooth
        selectedTeeth.push(toothNumber);
        element.classList.add('selected');
      }
      
      updateSelectedTeethDisplay();
    }

    function updateSelectedTeethDisplay() {
      const display = document.getElementById('selectedTeeth');
      const list = document.getElementById('selectedTeethList');
      const input = document.getElementById('toothNumbers');
      
      if (selectedTeeth.length > 0) {
        display.style.display = 'block';
        list.textContent = selectedTeeth.sort((a, b) => a - b).join(', ');
        input.value = selectedTeeth.join(',');
      } else {
        display.style.display = 'none';
        input.value = '';
      }
    }

    function updateMaterialOptions() {
      const itemType = document.getElementById('itemType').value;
      const materialSelect = document.getElementById('material');
      
      // Reset material options based on item type
      // This would normally be populated based on item type
      console.log('Item type changed to:', itemType);
    }

    function handleFileUpload(input) {
      const files = input.files;
      const container = document.getElementById('uploadedFiles');
      const photoFiles = document.getElementById('photoFiles');
      const xrayFiles = document.getElementById('xrayFiles');
      const documentFiles = document.getElementById('documentFiles');
      
      // Clear previous files display
      container.innerHTML = '';
      photoFiles.innerHTML = '';
      xrayFiles.innerHTML = '';
      documentFiles.innerHTML = '';
      
      if (files.length === 0) return;
      
      // Create main uploaded files list
      const filesTitle = document.createElement('h4');
      filesTitle.textContent = `üìé Uploaded Files (${files.length})`;
      filesTitle.style.marginBottom = '15px';
      filesTitle.style.color = '#003049';
      container.appendChild(filesTitle);
      
      Array.from(files).forEach((file, index) => {
        // Determine file category and icon
        let category, icon, categoryContainer;
        const fileType = file.type.toLowerCase();
        const fileName = file.name.toLowerCase();
        
        if (fileType.includes('image') || fileName.includes('photo') || fileName.includes('img')) {
          category = 'photo';
          icon = 'üì∑';
          categoryContainer = photoFiles;
        } else if (fileName.includes('xray') || fileName.includes('radiograph') || fileType.includes('dicom') || fileName.includes('.dcm')) {
          category = 'xray';
          icon = 'üî¨';
          categoryContainer = xrayFiles;
        } else {
          category = 'document';
          icon = 'üìÑ';
          categoryContainer = documentFiles;
        }
        
        // Create main file entry
        const fileDiv = document.createElement('div');
        fileDiv.className = 'uploaded-file';
        fileDiv.innerHTML = `
          <div class="file-info">
            <span class="file-icon">${icon}</span>
            <div class="file-details">
              <span class="file-name">${file.name}</span>
              <span class="file-size">${(file.size / 1024 / 1024).toFixed(2)} MB</span>
            </div>
          </div>
          <button type="button" class="file-remove" onclick="removeFile(${index}, this)">Remove</button>
        `;
        container.appendChild(fileDiv);
        
        // Add to category
        const categoryItem = document.createElement('div');
        categoryItem.style.cssText = 'padding: 8px; background: #e3f2fd; border-radius: 5px; margin-bottom: 5px; font-size: 12px; display: flex; justify-content: space-between; align-items: center;';
        categoryItem.innerHTML = `
          <span>${icon} ${file.name}</span>
          <span style="color: #666;">${(file.size / 1024 / 1024).toFixed(1)}MB</span>
        `;
        categoryContainer.appendChild(categoryItem);
      });
      
      // Update category placeholders
      if (photoFiles.children.length === 0) {
        photoFiles.innerHTML = '<div style="color: #999; font-style: italic;">No photos uploaded</div>';
      }
      if (xrayFiles.children.length === 0) {
        xrayFiles.innerHTML = '<div style="color: #999; font-style: italic;">No X-rays uploaded</div>';
      }
      if (documentFiles.children.length === 0) {
        documentFiles.innerHTML = '<div style="color: #999; font-style: italic;">No documents uploaded</div>';
      }
    }

    function removeFile(index, buttonElement) {
      // Remove the file from the display
      const fileDiv = buttonElement.closest('.uploaded-file');
      if (fileDiv) {
        fileDiv.remove();
      }
      
      // In a real implementation, you would also remove the file from the input
      // For now, we'll just show a message
      console.log('Remove file at index:', index);
      
      // Update the file counter
      const container = document.getElementById('uploadedFiles');
      const remainingFiles = container.querySelectorAll('.uploaded-file').length;
      const title = container.querySelector('h4');
      if (title) {
        title.textContent = `üìé Uploaded Files (${remainingFiles})`;
      }
      
      // If no files remain, clear the container
      if (remainingFiles === 0) {
        container.innerHTML = '';
        // Reset category displays
        document.getElementById('photoFiles').innerHTML = '<div style="color: #999; font-style: italic;">No photos uploaded</div>';
        document.getElementById('xrayFiles').innerHTML = '<div style="color: #999; font-style: italic;">No X-rays uploaded</div>';
        document.getElementById('documentFiles').innerHTML = '<div style="color: #999; font-style: italic;">No documents uploaded</div>';
      }
    }

    function saveDraft() {
      const autoSave = document.getElementById('autoSave');
      autoSave.classList.add('show');
      
      setTimeout(() => {
        autoSave.classList.remove('show');
      }, 2000);
      
      alert('üíæ Draft saved successfully!\n\nYou can continue working on this case later from your drafts folder.');
    }

    function resetForm() {
      if (confirm('Are you sure you want to reset the form? All entered data will be lost.')) {
        document.getElementById('newCaseForm').reset();
        selectedTeeth = [];
        selectedPriority = 2;
        updateSelectedTeethDisplay();
        document.querySelectorAll('.priority-option').forEach(opt => opt.classList.remove('selected'));
        document.querySelector('.priority-option.priority-normal').classList.add('selected');
        document.querySelectorAll('.tooth-number').forEach(tooth => tooth.classList.remove('selected'));
      }
    }

    function goBack() {
      if (confirm('Are you sure you want to leave? Any unsaved changes will be lost.')) {
        alert('‚Üê Returning to dashboard...');
      }
    }

    // Form submission
    document.getElementById('newCaseForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const patient = document.getElementById('patientSelect').value;
      const doctor = document.getElementById('doctorSelect').value;
      const practice = document.getElementById('practiceSelect').value;
      const itemType = document.getElementById('itemType').value;
      const teeth = document.getElementById('toothNumbers').value;
      const price = document.getElementById('price').value;
      const paymentStatus = document.getElementById('paymentStatus').value;
      
      if (!patient || !doctor || !practice || !itemType || !teeth || !price || !paymentStatus) {
        alert('‚ùå Please fill in all required fields marked with *');
        return;
      }
      
      if (selectedTeeth.length === 0) {
        alert('‚ùå Please select at least one tooth');
        return;
      }
      
      if (parseFloat(price) <= 0) {
        alert('‚ùå Please enter a valid price greater than 0');
        return;
      }
      
      // Simulate form submission
      alert(`‚úÖ Case created successfully!\n\n` +
            `Patient: ${document.getElementById('patientSelect').selectedOptions[0].text}\n` +
            `Doctor: ${document.getElementById('doctorSelect').selectedOptions[0].text}\n` +
            `Item Type: ${document.getElementById('itemType').selectedOptions[0].text}\n` +
            `Teeth: ${selectedTeeth.join(', ')}\n` +
            `Priority: ${document.querySelector('.priority-option.selected').textContent.trim()}\n` +
            `Price: ${parseFloat(price).toFixed(2)}\n` +
            `Payment Status: ${document.getElementById('paymentStatus').selectedOptions[0].text}\n\n` +
            `The case has been assigned a number and the doctor has been notified.`);
    });

    // Auto-save functionality
    setInterval(() => {
      const formData = new FormData(document.getElementById('newCaseForm'));
      // This would save form data to localStorage or send to server
    }, 30000); // Auto-save every 30 seconds

    // Set minimum date to tomorrow
    document.addEventListener('DOMContentLoaded', function() {
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      document.getElementById('deadline').min = tomorrow.toISOString().split('T')[0];
      
      // Add drag and drop functionality
      const uploadArea = document.querySelector('.file-upload-main');
      
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, preventDefaults, false);
      });
      
      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }
      
      ['dragenter', 'dragover'].forEach(eventName => {
        uploadArea.addEventListener(eventName, highlight, false);
      });
      
      ['dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, unhighlight, false);
      });
      
      function highlight(e) {
        uploadArea.style.background = '#BCDDE4';
        uploadArea.style.borderColor = '#003049';
        uploadArea.style.transform = 'scale(1.02)';
      }
      
      function unhighlight(e) {
        uploadArea.style.background = 'white';
        uploadArea.style.borderColor = '#197CAE';
        uploadArea.style.transform = 'scale(1)';
      }
      
      uploadArea.addEventListener('drop', handleDrop, false);
      
      function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        
        // Simulate file input change
        document.getElementById('fileInput').files = files;
        handleFileUpload(document.getElementById('fileInput'));
      }
    });
  </script>
</body>
</html>