<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Case Details - Dental Practice</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #BCDDE4;
      min-height: 100vh;
      padding: 20px;
    }

    .app-container {
      background: #EDEDED;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      max-width: 1000px;
      margin: 0 auto;
      animation: slideUp 0.6s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      background: linear-gradient(135deg, #197CAE 0%, #003049 100%);
      padding: 30px;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-info h1 {
      font-size: 28px;
      margin-bottom: 5px;
    }

    .header-info p {
      opacity: 0.9;
      font-size: 14px;
    }

    .case-status {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      margin-left: 15px;
      display: inline-block;
    }

    .status-new { background: #e3f2fd; color: #1976d2; }
    .status-in-progress { background: #fff3e0; color: #f57c00; }
    .status-completed { background: #e8f5e8; color: #388e3c; }
    .status-urgent { background: #ffebee; color: #d32f2f; }

    .header-actions {
      display: flex;
      gap: 15px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .btn-primary {
      background: #FFCB05;
      color: #003049;
    }

    .btn-primary:hover {
      background: #e6b405;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .content {
      padding: 40px 30px;
    }

    .case-overview {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
      margin-bottom: 40px;
    }

    .main-info {
      background: white;
      border-radius: 15px;
      padding: 30px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .main-info:hover {
      border-color: #197CAE;
      box-shadow: 0 10px 25px rgba(0, 48, 73, 0.1);
    }

    .case-title {
      font-size: 24px;
      color: #003049;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #BCDDE4;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .info-item {
      display: flex;
      flex-direction: column;
    }

    .info-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
      text-transform: uppercase;
      font-weight: 500;
    }

    .info-value {
      font-size: 16px;
      color: #003049;
      font-weight: 600;
    }

    .priority-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 500;
    }

    .priority-low { background: #e8f5e8; color: #388e3c; }
    .priority-normal { background: #e3f2fd; color: #1976d2; }
    .priority-high { background: #fff3e0; color: #f57c00; }
    .priority-urgent { background: #ffebee; color: #d32f2f; }

    .side-panel {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .panel-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .panel-card:hover {
      border-color: #197CAE;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 48, 73, 0.1);
    }

    .panel-card h3 {
      color: #003049;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .notes-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .notes-section:hover {
      border-color: #197CAE;
      box-shadow: 0 10px 25px rgba(0, 48, 73, 0.1);
    }

    .notes-content {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid #197CAE;
      font-style: italic;
      color: #003049;
      line-height: 1.6;
    }

    .case-title {
      font-size: 24px;
      color: #003049;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #BCDDE4;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .edit-note-btn {
      background: #197CAE;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 15px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .edit-note-btn:hover {
      background: #003049;
      transform: translateY(-1px);
    }

    .notes-editor {
      margin-top: 15px;
    }

    .notes-editor textarea {
      width: 100%;
      min-height: 120px;
      padding: 15px;
      border: 2px solid #197CAE;
      border-radius: 10px;
      font-family: inherit;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
      margin-bottom: 15px;
    }

    .notes-editor textarea:focus {
      outline: none;
      border-color: #003049;
      box-shadow: 0 0 0 3px rgba(25, 124, 174, 0.1);
    }

    .notes-editor-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .save-note-btn {
      background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .save-note-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }

    .cancel-note-btn {
      background: transparent;
      color: #666;
      border: 2px solid #ddd;
      padding: 8px 18px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .cancel-note-btn:hover {
      border-color: #f44336;
      color: #f44336;
      transform: translateY(-1px);
    }

    .technical-specs {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .technical-specs:hover {
      border-color: #197CAE;
      box-shadow: 0 10px 25px rgba(0, 48, 73, 0.1);
    }

    .specs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
    }

    .spec-item {
      text-align: center;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    .spec-item:hover {
      background: #BCDDE4;
      transform: translateY(-2px);
    }

    .spec-icon {
      font-size: 30px;
      margin-bottom: 10px;
      display: block;
    }

    .spec-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }

    .spec-value {
      font-size: 16px;
      color: #003049;
      font-weight: 600;
    }

    .action-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 30px;
    }

    .action-btn {
      background: linear-gradient(135deg, #197CAE 0%, #003049 100%);
      color: white;
      border: none;
      padding: 15px 20px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .action-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(25, 124, 174, 0.3);
    }

    .payment-status {
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
    }

    .payment-pending { background: #fff3e0; color: #f57c00; }
    .payment-paid { background: #e8f5e8; color: #388e3c; }
    .payment-overdue { background: #ffebee; color: #d32f2f; }
    .payment-partial { background: #e3f2fd; color: #1976d2; }
    .payment-insurance { background: #f3e5f5; color: #7b1fa2; }
    .payment-cancelled { background: #eeeeee; color: #616161; }

    @media (max-width: 768px) {
      .case-overview {
        grid-template-columns: 1fr;
      }

      .info-grid {
        grid-template-columns: 1fr;
      }

      .specs-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }

      .action-buttons {
        grid-template-columns: 1fr;
      }

      .message-input-wrapper {
        flex-direction: column;
        align-items: stretch;
      }

      .message-actions {
        justify-content: center;
      }

      .message-item.own-message {
        margin-left: 10px;
      }

      .messages-list {
        max-height: 300px;
      }

      .case-title {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
      }

      .notes-editor-actions {
        flex-direction: column;
      }

      .notes-editor textarea {
        min-height: 100px;
      }
    }

    .delivery-info {
      background: #f0f8ff;
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid #197CAE;
      margin-top: 20px;
    }

    .delivery-info h4 {
      color: #003049;
      margin-bottom: 10px;
    }

    .delivery-address {
      color: #003049;
      line-height: 1.5;
    }

    .update-log {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin-top: 15px;
    }

    .update-item {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 4px solid #197CAE;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }

    .update-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .update-item:last-child {
      margin-bottom: 0;
    }

    .update-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .update-user {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .user-avatar {
      font-size: 16px;
      width: 28px;
      height: 28px;
      background: #197CAE;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .user-name {
      font-weight: 600;
      color: #003049;
      font-size: 14px;
    }

    .update-time {
      color: #666;
      font-size: 12px;
    }

    .update-action {
      font-weight: 500;
      color: #197CAE;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .update-details {
      color: #666;
      font-size: 13px;
      line-height: 1.4;
    }

    .messages-container {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 20px;
      margin-top: 15px;
    }

    .messages-list {
      max-height: 400px;
      overflow-y: auto;
      margin-bottom: 20px;
      padding-right: 10px;
    }

    .message-item {
      background: white;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      border-left: 4px solid #197CAE;
    }

    .message-item:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .message-item.own-message {
      background: #e3f2fd;
      border-left: 4px solid #FFCB05;
      margin-left: 20px;
    }

    .message-item:last-child {
      margin-bottom: 0;
    }

    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .message-user {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .message-time {
      color: #666;
      font-size: 12px;
    }

    .message-content {
      color: #003049;
      line-height: 1.5;
      font-size: 14px;
    }

    .message-input-container {
      background: white;
      border-radius: 12px;
      padding: 15px;
      border: 2px solid #ddd;
      transition: border-color 0.3s ease;
    }

    .message-input-container:focus-within {
      border-color: #197CAE;
    }

    .message-input-wrapper {
      display: flex;
      gap: 10px;
      align-items: flex-end;
      margin-bottom: 10px;
    }

    .message-input-wrapper textarea {
      flex: 1;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px 12px;
      font-family: inherit;
      font-size: 14px;
      resize: vertical;
      min-height: 20px;
      max-height: 100px;
    }

    .message-input-wrapper textarea:focus {
      outline: none;
      border-color: #197CAE;
    }

    .send-message-btn {
      background: linear-gradient(135deg, #197CAE 0%, #003049 100%);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .send-message-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(25, 124, 174, 0.3);
    }

    .send-message-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .message-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .message-action-btn {
      background: transparent;
      color: #197CAE;
      border: 1px solid #197CAE;
      padding: 6px 12px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .message-action-btn:hover {
      background: #197CAE;
      color: white;
      transform: translateY(-1px);
    }

    .messages-list::-webkit-scrollbar {
      width: 6px;
    }

    .messages-list::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }

    .messages-list::-webkit-scrollbar-thumb {
      background: #197CAE;
      border-radius: 3px;
    }

    .messages-list::-webkit-scrollbar-thumb:hover {
      background: #003049;
    }

    .update-log {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin-top: 15px;
    }

    .update-item {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 4px solid #197CAE;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }

    .update-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .update-item:last-child {
      margin-bottom: 0;
    }

    .update-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .update-user {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .user-avatar {
      font-size: 16px;
      width: 28px;
      height: 28px;
      background: #197CAE;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .user-name {
      font-weight: 600;
      color: #003049;
      font-size: 14px;
    }

    .update-time {
      color: #666;
      font-size: 12px;
    }

    .update-action {
      font-weight: 500;
      color: #197CAE;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .update-details {
      color: #666;
      font-size: 13px;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <div class="header-info">
        <h1>Case #0001</h1>
        <p>Crown Restoration - Maria Rodriguez</p>
        <span class="case-status status-in-progress">IN PROGRESS</span>
      </div>
      <div class="header-actions">
        <button class="btn btn-primary" onclick="editCase()">Edit Case</button>
        <a href="#" class="btn btn-secondary" onclick="goBack()">← Back to Cases</a>
      </div>
    </div>

    <div class="content">
      <!-- Case Overview -->
      <div class="case-overview">
        <div class="main-info">
          <div class="case-title">Case Information</div>
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Patient Name</div>
              <div class="info-value">Maria Rodriguez</div>
            </div>
            <div class="info-item">
              <div class="info-label">Doctor</div>
              <div class="info-value">Dr. Sarah Johnson</div>
            </div>
            <div class="info-item">
              <div class="info-label">Practice</div>
              <div class="info-value">Downtown Dental Clinic</div>
            </div>
            <div class="info-item">
              <div class="info-label">Technician</div>
              <div class="info-value">John Tech</div>
            </div>
            <div class="info-item">
              <div class="info-label">Case Date</div>
              <div class="info-value">August 1, 2025</div>
            </div>
            <div class="info-item">
              <div class="info-label">Deadline</div>
              <div class="info-value">August 3, 2025</div>
            </div>
            <div class="info-item">
              <div class="info-label">Priority</div>
              <div class="info-value">
                <span class="priority-badge priority-urgent">URGENT</span>
              </div>
            </div>
            <div class="info-item">
              <div class="info-label">Price</div>
              <div class="info-value" style="font-size: 20px; color: #197CAE; font-weight: bold;">$450.00</div>
            </div>
            <div class="info-item">
              <div class="info-label">Payment Status</div>
              <div class="info-value">
                <span class="payment-status payment-pending">PENDING</span>
              </div>
            </div>
            <div class="info-item">
              <div class="info-label">Tooth Number</div>
              <div class="info-value">#14</div>
            </div>
          </div>
        </div>

        <div class="side-panel">
          <div class="panel-card">
            <h3>📋 Case Summary</h3>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span>Case Type</span>
                <span style="font-weight: bold; color: #197CAE;">Crown Restoration</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span>Priority</span>
                <span class="priority-badge priority-urgent">URGENT</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span>Status</span>
                <span style="font-weight: bold; color: #f57c00;">In Progress</span>
              </div>
              <div style="display: flex; justify-content: space-between; border-top: 1px solid #ddd; padding-top: 10px; margin-top: 10px;">
                <span style="font-weight: bold;">Total Price</span>
                <span style="font-weight: bold; color: #197CAE; font-size: 18px;">$450.00</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Technical Specifications -->
      <div class="technical-specs">
        <div class="case-title">Technical Specifications</div>
        <div class="specs-grid">
          <div class="spec-item">
            <span class="spec-icon">🦷</span>
            <div class="spec-label">Item Type</div>
            <div class="spec-value">Crown</div>
          </div>
          <div class="spec-item">
            <span class="spec-icon">💎</span>
            <div class="spec-label">Material</div>
            <div class="spec-value">Zirconia</div>
          </div>
          <div class="spec-item">
            <span class="spec-icon">🎨</span>
            <div class="spec-label">Shade</div>
            <div class="spec-value">A2</div>
          </div>
        </div>
      </div>

      <!-- Notes Section -->
      <div class="notes-section">
        <div class="case-title">Special Instructions & Notes</div>
        <div class="notes-content">
          "Rush order - patient has important event this weekend. Please ensure perfect color match with adjacent teeth. Patient prefers slightly more translucent finish. Contact Dr. Johnson if any questions about occlusion."
        </div>
      </div>

      <!-- Delivery Information -->
      <div class="notes-section">
        <div class="case-title">Delivery Information</div>
        <div class="delivery-info">
          <h4>📍 Delivery Address</h4>
          <div class="delivery-address">
            Downtown Dental Clinic<br>
            123 Main Street, Suite 200<br>
            Downtown, State 12345<br>
            Phone: (555) 123-4567
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="action-btn" onclick="updateStatus()">
          <span>📝</span> Update Status
        </button>
        <button class="action-btn" onclick="addNote()">
          <span>💬</span> Add Note
        </button>
        <button class="action-btn" onclick="uploadPhotos()">
          <span>📷</span> Upload Photos
        </button>
        <button class="action-btn" onclick="markComplete()">
          <span>✅</span> Mark Complete
        </button>
        <button class="action-btn" onclick="sendMessage()">
          <span>✉️</span> Message Doctor
        </button>
        <button class="action-btn" onclick="printCase()">
          <span>🖨️</span> Print Details
        </button>
      </div>
    </div>
  </div>

  <script>
    // Current user info (this would come from login session)
    const currentUser = {
      name: "John Tech",
      avatar: "👨‍🔬",
      role: "Technician"
    };

    function addUpdateLogEntry(action, details) {
      const updateLog = document.querySelector('.update-log');
      const now = new Date();
      const timeAgo = "Just now";
      
      // Create new update item
      const updateItem = document.createElement('div');
      updateItem.className = 'update-item';
      updateItem.style.opacity = '0';
      updateItem.style.transform = 'translateY(-10px)';
      
      updateItem.innerHTML = `
        <div class="update-header">
          <div class="update-user">
            <span class="user-avatar">${currentUser.avatar}</span>
            <span class="user-name">${currentUser.name}</span>
          </div>
          <div class="update-time">${timeAgo}</div>
        </div>
        <div class="update-action">${action}</div>
        <div class="update-details">${details}</div>
      `;
      
      // Insert at the top of the log
      updateLog.insertBefore(updateItem, updateLog.firstChild);
      
      // Animate in
      setTimeout(() => {
        updateItem.style.transition = 'all 0.5s ease';
        updateItem.style.opacity = '1';
        updateItem.style.transform = 'translateY(0)';
      }, 100);
      
      // Highlight briefly
      setTimeout(() => {
        updateItem.style.backgroundColor = '#e8f5e8';
        setTimeout(() => {
          updateItem.style.backgroundColor = 'white';
        }, 2000);
      }, 600);
    }

    function updateStatus() {
      const statuses = ['New', 'In Progress', 'Quality Check', 'Completed', 'Delivered'];
      const currentStatus = 'In Progress';
      
      const newStatus = prompt(`📝 Update Case Status\n\nCurrent Status: ${currentStatus}\n\nAvailable statuses:\n${statuses.map((s, i) => `${i + 1}. ${s}`).join('\n')}\n\nEnter new status:`);
      
      if (newStatus && statuses.includes(newStatus)) {
        // Update the display
        const statusElements = document.querySelectorAll('.case-status, .status-badge');
        statusElements.forEach(el => {
          el.textContent = newStatus.toUpperCase();
          el.className = `case-status status-${newStatus.toLowerCase().replace(' ', '-')}`;
        });
        
        // Add to update log
        addUpdateLogEntry(
          `Changed status to "${newStatus}"`,
          `Case status updated from "${currentStatus}" to "${newStatus}"`
        );
        
        alert(`✅ Status updated to "${newStatus}"`);
      }
    }

    function addNote() {
      // This function is now replaced by toggleNoteEdit
      toggleNoteEdit();
    }

    function toggleNoteEdit() {
      const notesContent = document.getElementById('notesContent');
      const notesEditor = document.getElementById('notesEditor');
      const editBtn = document.getElementById('editNoteBtn');
      const textarea = document.getElementById('notesTextarea');
      
      if (notesEditor.style.display === 'none') {
        // Switch to edit mode
        notesContent.style.display = 'none';
        notesEditor.style.display = 'block';
        editBtn.innerHTML = '<span>👁️</span> View Notes';
        
        // Pre-fill textarea with current content (remove quotes and clean up)
        const currentText = notesContent.textContent.replace(/^"|"$/g, '').trim();
        textarea.value = currentText;
        textarea.focus();
        
        // Auto-resize textarea to fit content
        textarea.style.height = 'auto';
        textarea.style.height = (textarea.scrollHeight) + 'px';
      } else {
        // Switch to view mode
        notesContent.style.display = 'block';
        notesEditor.style.display = 'none';
        editBtn.innerHTML = '<span>📝</span> Add Note';
      }
    }

    function saveNote() {
      const textarea = document.getElementById('notesTextarea');
      const notesContent = document.getElementById('notesContent');
      const newNote = textarea.value.trim();
      
      if (!newNote) {
        alert('Please enter a note before saving.');
        return;
      }
      
      // Get current content and add new note
      const currentText = notesContent.textContent.replace(/^"|"$/g, '').trim();
      const timestamp = new Date().toLocaleString();
      const updatedContent = currentText + `\n\n--- New Note (${timestamp}) ---\n${newNote}`;
      
      // Update the notes content
      notesContent.textContent = `"${updatedContent}"`;
      
      // Add to update log
      addUpdateLogEntry(
        'Added case note',
        `Note: "${newNote.length > 50 ? newNote.substring(0, 50) + '...' : newNote}"`
      );
      
      // Switch back to view mode
      toggleNoteEdit();
      
      // Highlight the updated notes section briefly
      notesContent.style.backgroundColor = '#e8f5e8';
      setTimeout(() => {
        notesContent.style.backgroundColor = '#f8f9fa';
      }, 2000);
      
      // Show success message
      const successMsg = document.createElement('div');
      successMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #4caf50; color: white; padding: 10px 20px; border-radius: 20px; z-index: 1000; animation: slideUp 0.5s ease;';
      successMsg.textContent = '✅ Note saved successfully!';
      document.body.appendChild(successMsg);
      
      setTimeout(() => {
        successMsg.remove();
      }, 3000);
    }

    function cancelNoteEdit() {
      const textarea = document.getElementById('notesTextarea');
      
      if (textarea.value.trim() && textarea.value.trim() !== document.getElementById('notesContent').textContent.replace(/^"|"$/g, '').trim()) {
        if (!confirm('You have unsaved changes. Are you sure you want to cancel?')) {
          return;
        }
      }
      
      // Clear textarea and switch back to view mode
      textarea.value = '';
      toggleNoteEdit();
    }

    function uploadPhotos() {
      const fileTypes = ['Progress photo', 'X-ray image', 'Impression scan', 'Reference document'];
      const selectedType = prompt(`📷 Upload Files\n\nSelect file type:\n${fileTypes.map((t, i) => `${i + 1}. ${t}`).join('\n')}\n\nEnter number:`);
      
      if (selectedType && selectedType >= 1 && selectedType <= 4) {
        const fileName = `${fileTypes[selectedType - 1].toLowerCase().replace(' ', '_')}_${Date.now()}.jpg`;
        
        // Add to update log
        addUpdateLogEntry(
          'Uploaded file',
          `Added file: "${fileName}" (${fileTypes[selectedType - 1]})`
        );
        
        alert(`✅ File "${fileName}" uploaded successfully!`);
      }
    }

    function markComplete() {
      if (confirm('✅ Mark this case as complete?\n\nThis will:\n• Update the status to "Completed"\n• Set completion date\n• Notify the doctor\n• Generate completion report\n\nContinue?')) {
        // Update status display
        const statusElements = document.querySelectorAll('.case-status, .status-badge');
        statusElements.forEach(el => {
          el.textContent = 'COMPLETED';
          el.className = 'case-status status-completed';
        });
        
        // Add to update log
        addUpdateLogEntry(
          'Marked case as completed',
          'Case completed and ready for delivery. Doctor notification sent automatically.'
        );
        
        alert('🎉 Case marked as complete!\n\nThe doctor has been notified and the case is ready for pickup.');
      }
    }

    function sendMessage() {
      const message = prompt('✉️ Send Message to Dr. Johnson\n\nEnter your message:');
      
      if (message && message.trim()) {
        // Add to update log
        addUpdateLogEntry(
          'Sent message to doctor',
          `Message: "${message}"`
        );
        
        alert(`✅ Message sent to Dr. Johnson: "${message}"`);
      }
    }

    function sendCaseMessage() {
      const messageInput = document.getElementById('messageInput');
      const message = messageInput.value.trim();
      
      if (!message) {
        alert('Please enter a message');
        return;
      }
      
      const messagesList = document.getElementById('messagesList');
      const now = new Date();
      
      // Create new message element
      const messageItem = document.createElement('div');
      messageItem.className = 'message-item own-message';
      messageItem.style.opacity = '0';
      messageItem.style.transform = 'translateY(10px)';
      
      messageItem.innerHTML = `
        <div class="message-header">
          <div class="message-user">
            <span class="user-avatar">${currentUser.avatar}</span>
            <span class="user-name">${currentUser.name} (You)</span>
          </div>
          <div class="message-time">Just now</div>
        </div>
        <div class="message-content">${message}</div>
      `;
      
      // Add to messages list
      messagesList.appendChild(messageItem);
      
      // Animate in
      setTimeout(() => {
        messageItem.style.transition = 'all 0.5s ease';
        messageItem.style.opacity = '1';
        messageItem.style.transform = 'translateY(0)';
      }, 100);
      
      // Scroll to bottom
      messagesList.scrollTop = messagesList.scrollHeight;
      
      // Clear input
      messageInput.value = '';
      
      // Add to update log
      addUpdateLogEntry(
        'Sent case message',
        `Message: "${message.length > 50 ? message.substring(0, 50) + '...' : message}"`
      );
      
      // Auto-resize textarea
      messageInput.style.height = 'auto';
    }

    function attachFile() {
      const fileTypes = ['Photo', 'X-ray', 'Document', 'Reference'];
      const fileType = prompt(`📎 Attach File\n\nSelect file type:\n${fileTypes.map((t, i) => `${i + 1}. ${t}`).join('\n')}\n\nEnter number:`);
      
      if (fileType && fileType >= 1 && fileType <= 4) {
        const fileName = `attachment_${Date.now()}.jpg`;
        
        // Add file attachment message
        const messagesList = document.getElementById('messagesList');
        const messageItem = document.createElement('div');
        messageItem.className = 'message-item own-message';
        
        messageItem.innerHTML = `
          <div class="message-header">
            <div class="message-user">
              <span class="user-avatar">${currentUser.avatar}</span>
              <span class="user-name">${currentUser.name} (You)</span>
            </div>
            <div class="message-time">Just now</div>
          </div>
          <div class="message-content">
            📎 <strong>File attached:</strong> ${fileName}<br>
            <small>Type: ${fileTypes[fileType - 1]}</small>
          </div>
        `;
        
        messagesList.appendChild(messageItem);
        messagesList.scrollTop = messagesList.scrollHeight;
        
        // Add to update log
        addUpdateLogEntry(
          'Attached file to message',
          `File: "${fileName}" (${fileTypes[fileType - 1]})`
        );
      }
    }

    function addUrgentFlag() {
      const messageInput = document.getElementById('messageInput');
      if (messageInput.value.trim()) {
        messageInput.value = `⚡ URGENT: ${messageInput.value}`;
        messageInput.focus();
      } else {
        messageInput.value = '⚡ URGENT: ';
        messageInput.focus();
      }
    }

    function mentionDoctor() {
      const doctors = ['Dr. Sarah Johnson', 'Dr. Michael Martinez', 'Dr. Lisa Williams'];
      const doctor = prompt(`@ Mention Doctor\n\nSelect doctor to mention:\n${doctors.map((d, i) => `${i + 1}. ${d}`).join('\n')}\n\nEnter number:`);
      
      if (doctor && doctor >= 1 && doctor <= 3) {
        const messageInput = document.getElementById('messageInput');
        const mention = `@${doctors[doctor - 1]} `;
        messageInput.value = mention + messageInput.value;
        messageInput.focus();
        messageInput.setSelectionRange(mention.length, mention.length);
      }
    }

    function printCase() {
      // Add to update log
      addUpdateLogEntry(
        'Generated case report',
        'Printed comprehensive case details and documentation'
      );
      
      alert('🖨️ Generating Case Summary Report\n\nThis would create a printable PDF containing:\n\n• Complete case information\n• Technical specifications\n• Update history\n• Notes and instructions\n• Photos and documentation');
    }

    function editCase() {
      const sections = ['Patient Info', 'Specifications', 'Timeline', 'Notes', 'Files'];
      const section = prompt(`📝 Edit Case\n\nWhich section would you like to edit?\n${sections.map((s, i) => `${i + 1}. ${s}`).join('\n')}\n\nEnter number:`);
      
      if (section && section >= 1 && section <= 5) {
        // Add to update log
        addUpdateLogEntry(
          `Edited ${sections[section - 1]}`,
          `Modified case ${sections[section - 1].toLowerCase()} section`
        );
        
        alert(`📝 Opening ${sections[section - 1]} editor...`);
      }
    }

    function goBack() {
      alert('← Returning to cases list...');
    }

    // Initialize with fade-in animation
    document.addEventListener('DOMContentLoaded', function() {
      const cards = document.querySelectorAll('.main-info, .panel-card, .technical-specs, .notes-section');
      cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        card.style.animation = 'slideUp 0.6s ease-out forwards';
      });

      // Add real-time clock for "time ago" updates
      setInterval(updateTimeStamps, 60000); // Update every minute
      
      // Setup message input functionality
      const messageInput = document.getElementById('messageInput');
      const sendBtn = document.querySelector('.send-message-btn');
      
      // Auto-resize textarea
      messageInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
        
        // Enable/disable send button
        sendBtn.disabled = !this.value.trim();
      });
      
      // Send message on Enter (Shift+Enter for new line)
      messageInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          if (this.value.trim()) {
            sendCaseMessage();
          }
        }
      });
      
      // Initial send button state
      sendBtn.disabled = true;
      
      // Setup notes textarea auto-resize
      const notesTextarea = document.getElementById('notesTextarea');
      notesTextarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
      });
    });

    function updateTimeStamps() {
      const timeElements = document.querySelectorAll('.update-time');
      timeElements.forEach((element, index) => {
        if (element.textContent === 'Just now') {
          element.textContent = '1 minute ago';
        } else if (element.textContent.includes('minute ago')) {
          const minutes = parseInt(element.textContent) + 1;
          element.textContent = `${minutes} minutes ago`;
        }
      });
    }
  </script>
</body>
</html>